(()=>{(()=>{let r=Math.random,P=a,c=a.getContext("2d"),o=a.cloneNode(),l=o.getContext("2d"),s=[],g=[],x=200;function M(){return{x:r()*a.width,y:r()*a.height,vx:0,vy:0,r:a.height*.001+15*r(),setpoint:r()*Math.PI*2,error:.5,gain:10.9+.8*r(),delayBuffer:[],emissionPower:1+5*r(),hue:240+20*r()}}function w(){a.width=o.width=innerWidth,a.height=o.height=innerHeight,a.style.filter="saturate(2)",s=[];for(let f=0;f<x;f++)s.push(M())}(()=>{function f(){l.fillStyle=`rgba(22, 178, 174, ${r()*.03-.005+.005})`,l.fillRect(0,0,o.width,o.height);for(let e=g.length-1;e>=0;e--){let i=g[e];if(i.x+=i.vx,i.y+=i.vy,i.a-=.1,i.a<=0)g.splice(e,1);else{l.fillStyle=i.err>0?`rgba(125,115,0,${i.a})`:`rgba(238,43,226,${i.a})`;let d=Math.max(0,i.err/Math.PI),h=i.err>0?i.r*(1+d*2):i.r;l.beginPath(),l.arc(i.x,i.y,h,0,Math.PI*2),l.fill()}}s.forEach((e,i)=>{let d=i>0?s[i-1]:null,h=0;d?(h=d.setpoint-e.setpoint,h=(h+Math.PI)%(2*Math.PI)-Math.PI,e.delayBuffer.push(h),e.delayBuffer.length>30&&(h=e.delayBuffer.shift()),e.setpoint+=e.gain*h):e.setpoint+=(r()-.5)*5*Math.PI;let p=12+1*r()*e.emissionPower*10.5;e.vx=(r()<.9?Math.sin(e.setpoint):Math.cos(e.setpoint))*p,e.vy=Math.sin(e.setpoint)*p,e.x+=e.vx*.43*r(),e.y+=e.vy*.3*r(),e.x<0&&(e.x=a.width),e.x>a.width&&(e.x=0),e.y<0&&(e.y=a.height),e.y>a.height&&(e.y=0);let u=.08+.4*(1-i/(x-1)),y=l.createRadialGradient(e.x,e.y,e.r*5*r(),e.x,e.y,e.r);y.addColorStop(0,`rgba(235,215,30,${u})`),y.addColorStop(1,`rgba(238,153,226,${u})`),l.fillStyle=y,l.beginPath(),l.arc(e.x,e.y,e.r,0,Math.PI*2),l.fill()}),c.drawImage(o,0,0),window.rafId=requestAnimationFrame(f),t.textContent=(Date.now()/1e3).toFixed(3)}registerExhibit(w,f)})()})();})();
