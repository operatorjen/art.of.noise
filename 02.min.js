(()=>{(()=>{let r=Math.random,c=a.getContext("2d"),f=a.cloneNode(),l=f.getContext("2d"),d=[],y=[],x=80;function M(){return{x:r()*a.width,y:r()*a.height,vx:0,vy:0,r:a.height*.001+25*r(),setpoint:r()*Math.PI*2,error:.1,gain:.9+.8*r(),delayBuffer:[],emissionPower:1+5*r(),hue:140+80*r()}}function w(){a.width=f.width=innerWidth,a.height=f.height=innerHeight,a.style.filter="saturate(3)",d=[];for(let h=0;h<x;h++)d.push(M())}function P(h,e){let i=h.setpoint,s=h.emissionPower;y.push({x:h.x,y:h.y,vx:Math.cos(i)*s,vy:Math.sin(i)*s,r:1+3*r(),a:1,err:e})}(()=>{function h(){l.fillStyle="rgba(120, 19, 93, 0.01)",l.fillRect(0,0,f.width,f.height);for(let e=y.length-1;e>=0;e--){let i=y[e];if(i.x+=i.vx,i.y+=i.vy,i.a-=.1,i.a<=0)y.splice(e,1);else{l.fillStyle=i.err>0?`rgba(125,115,0,${i.a})`:`rgba(38,43,226,${i.a})`;let s=Math.max(0,i.err/Math.PI),o=i.err>0?i.r*(1+s*2):i.r;l.beginPath(),l.arc(i.x,i.y,o,0,Math.PI*2),l.fill()}}d.forEach((e,i)=>{let s=i>0?d[i-1]:null,o=0;s?(o=s.setpoint-e.setpoint,o=(o+Math.PI)%(2*Math.PI)-Math.PI,e.delayBuffer.push(o),e.delayBuffer.length>30&&(o=e.delayBuffer.shift()),e.setpoint+=e.gain*o):e.setpoint+=(r()-.5)*15*Math.PI;let u=2+1*r()*e.emissionPower*20.5;e.vx=Math.cos(e.setpoint)*u,e.vy=Math.sin(e.setpoint)*u,e.x+=e.vx*.53,e.y+=e.vy*.53,e.x<0&&(e.x=a.width),e.x>a.width&&(e.x=0),e.y<0&&(e.y=a.height),e.y>a.height&&(e.y=0),r()<.02&&P(e,o);let p=.3+.1*(1-i/(x-1)),g=l.createRadialGradient(e.x,e.y,e.r*.5,e.x,e.y,e.r);g.addColorStop(0,`rgba(35,215,100,${p})`),g.addColorStop(.8,`rgba(138,53,226,${p})`),l.fillStyle=g,l.beginPath(),l.arc(e.x,e.y,e.r,0,Math.PI*2),l.fill()}),c.drawImage(f,0,0),window.rafId=requestAnimationFrame(h),t.textContent=(Date.now()/1e3).toFixed(3)}registerExhibit(w,h)})()})();})();
